[Security Overview 原文链接](https://developer.apple.com/library/content/documentation/Security/Conceptual/Security_Overview/Introduction/Introduction.html#//apple_ref/doc/uid/TP30000976)

# 简介
## 关于软件安全

在云计算，高速现代计算网络领域，安全是软件工程最重要的方面。  
理解安全的最重要的事情是这并不是一个子弹点。你不能在软件开发过程的重点再去接入它。必须在开始的时候就持续将安全注入你的应用或服务中，让其作为整个设计，实现，测试，发布的过程中的一部分。  

应用对于安全数据的责任  

![](https://developer.apple.com/library/archive/documentation/Security/Conceptual/Security_Overview/Art/security_overview_intro_art_2x.png)

### 概览

在应用程序层，安全意味着要意识到你的代码使用的信息以及确保它的安全和响应。比如，你的指责包括：  

- 让用户的私人数据远离窥探。以安全的方式存储数据，确保你的软件只收集所需要的信息。
- 小心对待不可信任的文件和数据。如果你的软件访问了网络或之前在某个时间通过网络发送给某人的文件，你的软件必须确保验证数据。如果没有的话，可能在不经意间就给攻击者提供了载体来访问其他的可能被存储到用户计算机或移动设备上的私人数据。
- 保护传输数据的安全。如果你的软件通过网络传输私人数据，你必须以一种安全的方式进行传输，以防止在传输过程中对数据进行未经授权的访问或修改。
- 尽可能鉴定数据的有效性。如果你的软件提供了访问或操作标记数据，它应该验证这些签名来确保数据没有被破坏。

#### 危险模型会帮助你定位危险的区域

在规划阶段，你必须确定软件危险的性质，并以最大限度提高安全性的方式构建代码。要这么做的话，你就得构建一个危险模型，用来展示你的软件可能被攻击的方式。

```
相关章节：风险评估和危险模型
```

#### 安全编码技术和系统安全功能会帮助你缓解这些危险

在开发中的每个技术阶段，你必须采取以下步骤降低风险：

- 避免可利用的编码确信。在实现过程中，你必须避免使用不安全的编码技术，它会导致代码注入，拒绝服务攻击，或者其他不正确的行为。
- 持续更新你的危险模型。在开发过程中，你应该持续定期执行风险评估以及更新你的危险模型作为软件进化，以便精确的反应你的风险。
- 不要重复造轮子。当保护你的软件以及数据的时候，你应该尽可能利用内建的安全功能，而非自己编写。通常来讲，你可能需要判断一个用户是否合法，发送消息给服务器来保护整体性以及数据在传输中的安全，或者安全的存储数据到本地磁盘来保护数据。

```
相关章节：编码安全，风险评估和危险模型，鉴定和授权，密钥服务
```

#### 工具能够帮助你捕获编码错误

在测试环境下，你应该利用静态分析器和其他的设计工具来帮助你查找安全隐患。

```
相关章节：其他安全资源
```

### 前置阅读

本文档假设你已经阅读了《Mac 技术概览》，《iOS 技术概览》之一或两者。

# 风险评估和风险模型

在你写下第一行代码之前，要有安全设计软件的意识。要做到这点真的很难；如果你的安全分析过程看起来简单，你可能已经错过了某些相当基础以及受益良多的安全编码设计了。  
风险评估和风险模型以以下三步发生。

	1. 评估风险。判断你丢失了多少。
	2. 判断潜在风险。查出你的代码中能够被攻击的不同的部分（包括代表你做的框架和库）。
	3. 缓解风险。确保你的代码的部分能够在被攻击时被保护的很好。

## 评估风险

要评估你的代码在妥协的时候要采取的措施带来的风险，你首先应该假设你的程序会被攻击。

### 假设你的软件会被攻击

一个攻击者花在攻击你的程序上的时间和效果取决于几个因素，包括：  

* 你的程序持有的数据的价值。它是否存储了数千个信用卡账号或者收集了某个用户的秘密？
* 提供你的代码依赖服务的公司的安全和可信性。
* 某个特定客户在你的程序上消费了。你的应用是否被汽车修理公司或者某个大公司使用过？
* 你的应用分发范围有多广。这款应用是被一个单一用户使用，小的工作群体，还是它是构建到一个操作系统中，用在全球范围的分发的？

基于这些相同因素，你需要判断风险可接受的等级。数据的丢失将会花费你的公司成千上万美金用来关闭所有潜在的安全隐患。另一方面，公司名誉的损失可能比它付出在设计和开发安全代码上高得多。

### 评估风险

当评估风险的时候，有这些因素需要考虑：  

* 如果你的软件被成功的攻击了，最坏的事是什么？
	它是否会盗用用户的身份，让攻击者获取用户电脑的控制，或者只是让攻击之得到某个游戏中的高分？
* 一次成功的攻击有多难？
  
* 它的目标有多大？

* 有多少用户会被攻击？

* 目标是否可访问？

## 判断潜在威胁

风险评估会给你类似于你有多大概率被攻击和攻击会引发的损失等指标。下一步是找出你是如何可能被攻击的，包括攻击所有你的兴趣点——不只是攻击你的软件，而且包括你的服务器，你的公司等等。要做到这点，你需要创建威胁模型，它描述了所有有价值的（信息、金钱等）易手的地方。

### 创建威胁模型

* 你的应用需要用到的数据类型
* 你的应用必须处理的不可信数据所处的环境
* 传输到你的应用所使用的数据类型
* 攻击者探索你的应用所做所为的方式
* 缓解每种探索的策略


* 程序输入。
* 程序输出。
* 数据存储到系统中。
* 程序环境。

### 考虑威胁的类型

有几种类型的威胁需要考虑，包括威胁数据，服务可用性和系统整体性。

#### 威胁数据

攻击者可能会修改数据，包括：  

* 在程序中被使用的数据（比如进程中的信息）。
* 由程序所表现的数据（比如）。
* 给予程序访问存储到硬盘上的数据。

#### 威胁服务可用性

#### 攻击系统整体

## 缓解威胁

### 使用常见缓解技术

### 懂得取舍

## 在结束时

## 常见标准

## 了解更多

大量的第三方安全书籍描述了更多关于威胁模型的细节。参见《其他安全资源》了解完整列表。

# 代码安全

没有软件是完美的。尽管设计错误会带来很多缺陷，但一些最具破坏性的缺陷是由实现错误引起的。设计缺陷和实现缺陷可能会损害数据，并可能导致软件行为异常。对实现缺陷的攻击有时也会引发你的软件执行攻击者提供的任意二进制代码。  
为了阻止这些攻击，威胁模型只能够让帮你到目前为止。它标识了基础结构中可能受到合理攻击的部分，但没有确定这些部分可能受到攻击的具体方式。  
所以，当你实现你的软件的时候，你必须将这些步骤使你的代码泄露变得更加困难。如果攻击者准备泄漏你的代码，你必须最小化潜在的危险。本章简介了如何编写安全，健壮的代码，并描述了操作系统和编译器中能够让你的工作变得更容易的功能。

## 编码的强化

代码强化指的是在代码本身中修复安全漏洞（而非设计错误）。本质上，代码强化很像修复坏掉的城墙中的砂浆，来阻止攻击者破坏它或者支撑船尾以修复泄露。  
以下是一些代码强化的技术：  

* 增加代码来校验输入，阻止整形溢出。
* 替换任何不安全的字符串函数调用为可识别缓冲区大小的调用，阻止缓冲区溢出。
* 尽量避免传输数据给解释器。当无法避免使用解释器的时候，要以安全的方式传递数据给解释器。避免以 SQL 查询的方式命令注入攻击，使用参数化 APIs（或手动饮用字符串，如果参数化 APIs 不可用的话）。避免 POSIX 系统函数。
* 设置合理的值给环境变量（PATH，USER 等）和其他基于这些值的不安全的判断。
* 修复导致争用条件的错误；这些可能导致不正确的行为（或更糟）。

在本章的末尾，你会找到一个文档的链接，它描述了这些技术的更多细节，以及其他的代码强化的技术。

## 编码签名

编码签名是一种用来确保可执行代码真实性的技术。通过对你的代码签名，操作系统能够验证一个应用没有被其他软件修改，以及更新该应用的时候验证是否确实是由作者发布的。其他技术，比如钥匙串和应用沙盒，利用签名更好的保护你的用户数据。  
不过，要了解细节，你需要学习一些更多的概念。由于这个原因，代码签名需要浏览《密码服务》。

## 最小权益原则

## app沙盒

## 权益分离

## 了解更多

更多关于代码健壮性的概念概览，阅读《安全编码指南》。
了解更多关于 App 沙盒，阅读《App 沙盒设计指南》。
更多关于 XPC 服务和 NSXPC，阅读《后台驻留程序和服务编程指南》。
你可以在《其他安全资源》中学些更多其他的 Apple 和第三方安全书籍。

# 授权和鉴权

## 授权

## 鉴权

## 了解更多

# 加密服务

加密服务规范了传输（安全沟通）和在其他（安全区域）存储数据的安全数据的基础。使用精确的运算，它们能够让你：  

* 加密和解密数据以便它不能够被外界监听所理解
* 通过哈希，签名和校验来校验数据是否被修改

## 加密和解密

### 对称加密

### 不对称加密

### 密码学

## 哈希

## 签名和校验

## 安全存储

### 钥匙链

### FileVault

### 数据保护

## 了解更多 

# 附录A：安全服务器和安全代理

# 附录B：终止使用者安全功能

# 附录C：其他安全资源

现在你已经阅读了很多基础部分，还有很多你需要学习的。首先，阅读这两个文档：  

* 《App 沙盒设计指南》告诉你在你编写第一行代码前，运行在沙盒环境中的设计代码所需要知道的事情。
* 《安全编码指南》更多细节，关于如何最大限度的以安全的方式设计代码，以及描述了当实际编写代码来避免安全漏洞的时候你该如何做。

当你准备好测试你的代码，Xcode 中的静态分析器是很好的用来揭示常见安全问题的工具。阅读《Xcode 帮助》来学习更多关于测试和分析等你可以执行在 Xcode 中执行的类型。  
在阅读这些文档之后，考虑阅读本附录其余部分的文档列表。

## 其他苹果文档

下列是一些其他的你可能感兴趣的苹果文档，取决于你想要学习哪些技术。

### 鉴权和授权

* 《鉴权、授权和权限指南》提供了有关授权和鉴权在概念层面的一些额外的信息（仅 macOS）。
* 《授权服务编程指南》和《授权服务 C 参考》解释了如何执行特定的授权相关的任务。(仅 macOS；注意很多这些任务，比如提高权限，在沙盒环境下不允许)
* 《开放目录编程指南》解释了如何使用开放目录接口来鉴权一个用户或者获得关于用户的信息。（仅 macOS）
* 《安全接口编程参考》描述了 OC 接口的授权服务。这个接口也提供了大量的安全相关的用户界面元素。（仅 macOS）
* 技术注解 TN2095，《授权给所有人》也讨论了授权服务的使用。（仅 macOS）

### 加密

### 代码和应用签名

### 安全存储

### 安全网络

### 特权分割

### 杂项

## 第三方文档

你可以考虑阅读以下优秀的计算机安全书籍。 分为主题领域。

### Cocoa 安全

* 《专业 Cocoa 应用安全》Wrox 专业出版社，2010。Lee, Graham J.

### 威胁模型

* Howard, Michael, 和 David LeBlanc。《编写安全代码》（第二版），微软出版社，2003.
* Anderson, Ross。《安全工程：构建可依赖分发系统指南》第二版，John Wiley & Sons, 2001。

### 模糊测试

* Sutton, Michael, Adam Greene, 和 Pedram Amini。《模糊测试：强制发觉安全漏洞》，Pearson 出版社 2007。
	
### 密码学

* Schneier, Bruce。《应用密码学》第二版。John Wiley & Sons. 1996.
* Brands, Stefan。MIT 出版社 2000.

### 安全网络

* Gray, John Shapley。UNIX 进程通信。第二版。
* Stevens, W. Richard. UNIX 网络编程：进程间通信。Vol 2，第二版。
* Stevens, W. Richard, Bill Fenner和Andres M. Rudoff。UNIX 网络编程：套间字网络接口。

### 通用

## 标准和协议参考

下列页面描述了一些 Apple 使用的标准、协议和算法。虽然很多都已经旧了，但标准并没有改变太多，无法使其有用性失效。

### 常见标准

* 更多的关于常见标准的相关信息，包括完整官方标准下载链接，参见常见标准端口 http://www.commoncriteriaportal.org/  和常见标准评估网页，以及许可认证（CCEVS）（http://www.niap-ccevs.org/cc-scheme/）。

### Kerberos

* 更多关于 Kerberos 鉴权信息，参见《MIT Kerberos 网页》。
* 参见《macOS 服务帮助》了解支持 Kerberos 服务的细节，以及如何实现一个 Kerberos KDC 在你的 macOS 服务器上。

### 其他安全网络协议

* 如 RFC 2617 中所描述的 HTTP 鉴权模型，《HTTP 鉴权：基本和深入访问鉴权》。
* 有关安全网络的 SSL 协议的信息，参见《IETF SSL Version 3.0 草稿特定》。对于 TLS 协议，参见《TLS 工作组网页》